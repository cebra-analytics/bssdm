% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/exdet.R
\name{exdet}
\alias{exdet}
\alias{exdet.Raster}
\alias{exdet.SpatRaster}
\alias{exdet.data.frame}
\alias{exdet.matrix}
\title{Extrapolation Detection for Species Distribution Models}
\usage{
exdet(x, ref, mic = FALSE, filename = "", tol = .Machine$double.eps, ...)

\method{exdet}{Raster}(x, ref, mic = FALSE, filename = "", tol = .Machine$double.eps, ...)

\method{exdet}{SpatRaster}(x, ref, mic = FALSE, filename = "", tol = .Machine$double.eps, ...)

\method{exdet}{data.frame}(x, ref, mic = FALSE, tol = .Machine$double.eps, ...)

\method{exdet}{matrix}(x, ref, mic = FALSE, tol = .Machine$double.eps, ...)
}
\arguments{
\item{x}{Climate (or environmental) data as a \code{terra::SpatRaster},
\code{raster::Raster*}, \code{data.frame}, or \code{matrix} where each
layer/column represents focal values of an environmental variable.}

\item{ref}{A \code{data.frame}, \code{matrix}, or \code{list} where each column/element
represents reference values for an environmental variable (corresponding
to those given in \code{x}).}

\item{mic}{Logical to indicate whether most influential covariates should be
returned. If \code{TRUE}, the function returns which variables are most
responsible for Type 1 and Type 2 novelty. Default is \code{FALSE}.}

\item{filename}{Optional filename for writing spatial raster output (i.e.,
the \code{exdet} raster only). Default is "".}

\item{tol}{Tolerance value passed to \code{mahalanobis()} for matrix inversion.
Default is \code{.Machine$double.eps}. See \code{?solve} for details.}

\item{...}{Additional parameters.}
}
\value{
If \code{x} is a \code{SpatRaster} or \code{Raster*} object, this function returns
a list containing:
\itemize{
\item \code{exdet}: a \code{SpatRaster} layer giving the extrapolation detection scores
where values < 0 indicate univariate novelty (Type 1), values between 0
and 1 indicate analog conditions, and values > 1 indicate novel covariate
combinations (Type 2);
\item \code{mic1}: a factor \code{SpatRaster} layer indicating which variable is most
influential for Type 1 novelty. Value is "Not novel" where no Type 1
novelty occurs (only included when \code{mic=TRUE}); and
\item \code{mic2}: a factor \code{SpatRaster} layer indicating which variable is most
influential for Type 2 novelty. Value is "Not novel" where no Type 2
novelty occurs (only included when \code{mic=TRUE}).
}

If \code{x} is a \code{data.frame} or \code{matrix}, the function will return a list as
above, but with single layer \code{SpatRaster} objects replaced by vectors,
and factor rasters replaced by factor vectors.
}
\description{
Detect and quantify both univariate (Type 1) and multivariate (Type 2)
environmental novelty when projecting species distribution models.
}
\details{
\code{exdet} implements the ExDet (Extrapolation Detection) method
described in Mesgaran et al. (2014). It detects both novel univariate
ranges (Type 1 novelty) and novel combinations of covariates (Type 2
novelty) in the projection area compared to the reference area.

Type 1 novelty is assessed by comparing each environmental variable to its
range in the reference data. Type 2 novelty is assessed using Mahalanobis
distance to detect novel combinations of variables, even when individual
variables are within their reference ranges.

The ExDet score prioritises univariate novelty. If one or more variables
are outside their reference range, Type 2 novelty is not considered.

When \code{mic=TRUE}, the most influential covariates (MIC) are identified for
both types of novelty. MIC1 identifies which variable contributes most to
Type 1 novelty (most outside its reference range). MIC2 identifies which
variable contributes most to Type 2 novelty (via leave-one-out influence
analysis). Areas with no novelty are labeled "Not novel" in the MIC outputs.
}
\examples{
\dontrun{
library(geodata)
library(terra)
library(tmap)
bio <- worldclim_global("bio", res = 10, path = tempdir())
aus <- gadm("AUS", level = 0, resolution = 2, path = tempdir())
occ <- spatSample(aus, size = 100, method = "random")
ref <- terra::extract(bio, occ, ID = FALSE)
ex <- exdet(bio, ref, mic = TRUE)

# Plot outputs
tmap::tm_shape(ex$exdet) +
  tmap::tm_raster(
    col.scale = tmap::tm_scale_continuous(values = "matplotlib.rd_bu", midpoint = 0),
    col.legend = tmap::tm_legend(
      position = tmap::tm_pos_out("right", "center"),
      title = "ExDet"
    )
  ) +
  tmap::tm_credits(
    paste(
      "Positive values indicate covariate correlations.",
      "Negative values indicate novel univariate ranges.",
      "Values around zero indicate analog conditions.",
      sep = "\n"
    ),
    position = tmap::tm_pos_out("center", "bottom")
  ) +
  tmap::tm_title("Extrapolation Detection")

tmap::tm_shape(ex$mic1) +
  tmap::tm_raster(
    col.scale = tmap::tm_scale_categorical(
      values = "20",
      n.max = nrow(levels(ex$mic1)[[1]])
    ),
    col.legend = tmap::tm_legend(title = "Most influential\ncovariate (MIC1)"),
    col.chart = tmap::tm_chart_donut()
  ) +
  tmap::tm_title("Type 1 novelty: Most influential covariate")

tmap::tm_shape(ex$mic2) +
  tmap::tm_raster(
    col.scale = tmap::tm_scale_categorical(
      values = "20",
      n.max = nrow(levels(ex$mic2)[[1]])
    ),
    col.legend = tmap::tm_legend(title = "Most influential\ncovariate (MIC2)"),
    col.chart = tmap::tm_chart_donut()
  ) +
  tmap::tm_title("Type 2 novelty: Most influential covariate")
}
}
\references{
Mesgaran, M. B., Cousens, R. D., and Webber, B. L. (2014). Here
be dragons: a tool for quantifying novelty due to covariate range and
correlation change when projecting species distribution models.
\emph{Diversity and Distributions}, 20(10): 1147-1159.
\doi{10.1111/ddi.12209}
}
\keyword{exdet,}
\keyword{extrapolation,}
\keyword{novelty,}
\keyword{sdm}
